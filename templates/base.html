<!DOCTYPE html>
<html lang="en">
<head>
  <title>{{pagename}} - Blog</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="/css/styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <style>
    /* Set black background color, white text and some padding */
    footer {
      background-color: #555;
      color: white;
      padding: 15px;
    }
  </style>
</head>
{%if user%}
	{%if user.pref_color%}
	<body style='background-color: {{user.pref_color}}'>
	{%elif user.img%}
	<body background="/view_photo/{{user.img}}">
	{%else%}
	<body>
	{%endif%}
{%else%}
<body>
{%endif%}

<nav class="menu navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Blog</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="/posts/news">Principal</a></li>
        {%if user%}
	        <li><a id="inbox-link" onclick="activate()">Mensajes</a></li>
	        <li><a href="/newpost">Postear</a></li>
      	{%endif%}
      </ul>
	  <div id='bandeja'>
	    {%if recent_msg%}
	      {%for msg in recent_msg%}
	        <center>
	          {{msg.subject|safe}}
	        </center>
	        <br>
	        {%if msg.submitter != "Administracion"%}
	          De: <a href="/profile?u={{msg.submitter}}">{{msg.submitter}}</a><br>
	        {%else%}
	          De: {{msg.submitter}}<br>
	        {%endif%}
	        <center>
	          {{msg.content|safe}}
	        </center>
	        <hr>
	      {%endfor%}
	    {%endif%}
	  </div>
      <form class="navbar-form navbar-right" action="/search" role="search">
        <div class="form-group input-group">
          <input type="text" class="form-control" name="q" placeholder="Buscar..." required="true">
          <input type="hidden" name="filter" value="all">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">
              <span class="glyphicon glyphicon-search"></span>
            </button>
          </span>
        </div>
      </form>
      {%if user%}
	      <ul class="nav navbar-nav navbar-right">
	        <li><a><span class="glyphicon glyphicon-user"></span> {{user.displayName}}</a>
	        	<ul>
	        		<li><a href="/profile">Mi perfil</a></li>
	        		{%if user.user_type == 'admin'%}
	        		<li><a href="/admin">Administracion</a></li>
	        		{%endif%}
	        		<li><a href="/profile/_edit">Editar perfil</a></li>
	        		<li><a href="/profile/_editpass">Cambiar contrasenia</a></li>
	        		<li><a href="/logout">Salir</a></li>
	        	</ul>
	        </li>
	      </ul>
	  {%else%}
	  	  <ul class="nav navbar-nav navbar-right">
	        <li><a href="/signup"> Registrar</a>
	        </li>
	        <li><a href="/login"><span class="glyphicon glyphicon-log-in"></span> Iniciar sesion</a></li>
	      </ul>
	  {%endif%}
    </div>
  </div>
</nav>
  
<div class="container text-center">
  <div class="row">
    <div class="col-sm-3 well">
      <div class="well">
      {%if user%}
        <a href="/profile"><p>Mi perfil</p>
        {%if user.img%}
        	<img src="/view_photo/{{user.img}}" class="img-circle" height="65" width="65" alt="Avatar">
        {%else%}
        	<img src="/img/profile.jpg" class="img-circle" height="65" width="65" alt="Avatar">
        {%endif%}
        </a>
      {%else%}
      	<form action="/login" method="post">
      		<input style="width: 100%;margin:2%" type="text" name="username" placeholder="Usuario">
      		<input style="width: 100%;margin:2%" type="password" name="password" placeholder="Contrasenia">
      		<input style="margin:2%" type="submit" name="submit" value="Iniciar Sesion">
      	</form>
      {%endif%}
      </div>
      <div class="well">
        <p><a href="#">Publicaciones</a></p>
        <p>
          <a href="/posts/news"><span class="label label-default">Novedades</span></a>
          <a href="/posts/animales"><span class="label label-primary">Animales</span></a>
          <a href="/posts/musica"><span class="label label-success">Musica</span></a>
          <a href="/posts/tecnologia"><span class="label label-info">Tecnologia</span></a>
          <a href="/posts/preguntas"><span class="label label-warning">Preguntas</span></a>
          <a href="/posts/programacion"><span class="label label-danger">Programacion</span></a>
        </p>
      </div>
      {%if user%}
      	{%if user.banned_from_comments and user.banned_from_posting%}
	      <div class="alert alert-success fade in">
	        <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
	        <p><strong>Ey!</strong></p>
	        No puedes comentar ni publicar
	      </div>
	    {%elif user.banned_from_comments%}
	      <div class="alert alert-success fade in">
	        <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
	        <p><strong>Ey!</strong></p>
	        No puedes publicar
	      </div>
	    {%elif user.banned_from_posting%}
	      <div class="alert alert-success fade in">
	        <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
	        <p><strong>Ey!</strong></p>
	        No puedes comentar
	      </div>
	    {%endif%}
	   {%endif%}
	  {%if user%}
	      <p><a href="/profile/_viewcomments?u={{user.displayName}}">Comentarios</a></p>
	      <ul class="change-bg">
		  <label class="change-bg-close">x</label>
		  <form action="/change-bg"><input type="color" name="color"><input type="submit" name="submit" value="Guardar"></form><form action="/change-bg"><input type="hidden" name="img" value="{{user.img}}"><button>Usar foto de perfil</button></form></ul>
	      <p><a href="/profile/_viewposts?u={{user.displayName}}">Posts</a></p>
	      <p><a href="/profile/_edit">Editar perfil</a></p>
	      <p class="change-bg-bt"><a>Cambiar fondo ►</a></p>
	  {%endif%}
    </div>
    <div class="col-sm-7">
    
    {%if user%}
      <div class="row">
        <div class="col-sm-12">
          <div class="panel panel-default text-left">
            <div class="panel-body">
              <p style="display: inline-block;">Tienes alguna duda?&nbsp;<p id="subjectp" contenteditable="True" style="display: inline-block;">Pregunta...</p></p>
            	<form action="/newpost" method="post">
            		<input type="hidden" name="subject" id="subject" value="Pregunta...">
            		<input type="text" placeholder="Que quieres saber?" name="content" style="width: 100%"><br>
            		<input type="hidden" name="topic" value="Preguntas">
            		<input type="submit" style="float: right;" name="submit" onclick="load_p()" value="Publicar">
            		<script type="text/javascript">
            			function load_p(){
            			var subject = $('#subjectp').html();
            			if (subject.length > 0){
            				$('#subject').val(subject)
            			}}
            		</script>
            	</form>
            </div>
          </div>
        </div>
      </div>
    {%endif%}
      <div class="page-content">
        {%block content%}
        {%endblock%}
      </div>
    </div>
    <div class="col-sm-2 well">
      <div class="thumbnail">
      </div>
      <div class="well">
      </div>
      <div class="well">
      </div>
    </div>
  </div>
</div>

<center><div id="loading" style="color:blue;font-weight:bold;"></div></center>

{%if profile%}
 		{%if profile.img%}
 			<script type='text/javascript'>
 				user_img = "{{profile.img}}"
 			</script>
 			<div class="img-viewer"><img class="img-viewer-img" src='/view_photo/{{profile.img}}'>
 		{%else%}
 			<div class="img-viewer"><img class="img-viewer-img" src='/img/profile.jpg'>
 		{%endif%}
 			<label id="img-viewer-close">Cerrar</label>
 		{%if modificable == True%}
	        <form action="{{upload_url}}" method="POST" runat="server" enctype="multipart/form-data" class="change-pic"> 
	          Cambiar foto: <input id="imginput" type="file" name="file"><br> 
 	          <input type="submit" name="submit" value="Guardar"> 
 	        </form>
 	    {%endif%}
 		 </div>
{%endif%}
<footer class="container-fluid text-center">
  <p>Hola que ase</p>
</footer>

  <script src="/js/jquery.js"></script>
  <script src="/js/javascript.js"></script>
</body>
</html>


