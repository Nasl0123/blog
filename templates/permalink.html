{%extends 'base.html'%}
{%block content%}
<center>

{%if post%}
		<h2 style="margin-left:20%;margin-right:20%"><a id="post-title">{{post.title}}</a></h2>
		<div style="max-width:500px;word-wrap:break-word"><pre>{{post.post}}</pre></div>
		{%if post.submitter.split("|")[1] != "False"%}
			<label style="float:left">Enviado por: <a id="post-submitter" href="/profile?u={{post.submitter.split('|')[0]}}">{{post.submitter.split("|")[0]}}</a></label>
		{%else%}
			<label style="float:left">Enviado por: <a id="post-submitter-deleted">{{post.submitter.split("|")[0]}}</a></label>
		{%endif%}
		<label style="float:right">{{post.created_str}}</label>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<div class="container" id='{{post.key().id()}}'> 
		    <a class="like"><i class="fa fa-thumbs-o-up"></i>  
		        Like <input class="qty1" name="qty1" readonly="readonly" type="text" value="{{post.like}}" />
		    </a>
		    <a class="dislike"><i class="fa fa-thumbs-o-down"></i> 
		        Dislike <input class="qty2"  name="qty2" readonly="readonly" type="int" value="{{post.dislike}}" />
		    </a>
		</div>
		<br>
		<button><a class="button" href="/{{post.key().id()}}?action=newcomment">Deja tu comentario</a></button>

		{%if post.submitter == 'ti'%}
			{%if post.modificable == 'pending'%}
				<b style="color: red;float:right">Tu peticion esta en proceso</b>
			{%else%}
				<a style="float:right" href="/{{post.key().id()}}/_editpost">Editar post</a>
			{%endif%}
		{%endif%}
		<hr>
		{%if comments%}
			{%for comment in comments%}
				<div class="post-comment">
					<div id="post-comment-title">{{comment.title}}: </div><div id="post-comment-content"> {{comment.content}}<div id="comment-content-full">{{comment.content}}</div></div>
					<div class="container" id ="{{comment.key().id()}}"> 
					    <a class="like"><i class="fa fa-thumbs-o-up"></i>  
					        Like <input class="qty1" name="qty1" readonly="readonly" type="text" value="" />
					        {{comment.like}}
					    </a>
					    <a class="dislike"><i class="fa fa-thumbs-o-down"></i> 
					        Dislike <input class="qty2"  name="qty2" readonly="readonly" type="text" value="" />{{comment.dislike}}
					    </a>
					</div>
					<div>{{comment.created_str}}</div>
					<br>
					{%if comment.submitter == 'ti'%}
						<a href="/{{post.key().id()}}?action=deletecomment&c={{comment.key().id()}}" id="edit-link">Borrar</a>
					{%endif%}
					{%if comment.submitter.split("|")[1] != "False"%}
						{%if comment.submitter.split('|')[0]=='ti'%}
							<a id="edit-link" href="/{{post.key().id()}}?action=editcomment&c={{comment.key().id()}}">Modificar</a>
						{%else%}
							{%if post.submitter != 'ti'%}
								<a id="edit-link" href="/{{post.key().id()}}?action=reportcomment&c={{comment.key().id()}}">Reportar</a>
							{%endif%}
						{%endif%}
						<div id="post-comment-submitter">Enviado por: <a id="comment-submitter" href="/profile?u={{comment.submitter.split('|')[0]}}">{{comment.submitter.split("|")[0]}}</a></div><br>
					{%else%}
						<div id="comment-submitter-deleted">Enviado por: {{comment.submitter.split("|")[0]}}</div><br>
					{%endif%}
				</div>
				<div style="display:none" id="hidden-edit-{{comment.key().id()}}">
					<form method="post">
						<textarea id="comment" name="content">{{comment.content}}</textarea>
						<button type="submit">Guardar comentario</button><FORM><INPUT Type="button" VALUE="Volver" onClick="history.go(-1);return true;"></FORM>

					</form>
				</div>
				<div style="display:none" id="hidden-report-{{comment.key().id()}}">
					<form method="post">
						<input type="text" id="comment" name="razon" placeholder="Escribe una razon valida"></input>
						<button type="submit">Reportar comentario</button><FORM><INPUT Type="button" VALUE="Volver" onClick="history.go(-1);return true;"></FORM>
					</form>
				</div>
				<hr>
			{%endfor%}
		{%endif%}
		<br>
		{%if newcomment==True%}
			<script type='text/javascript'>
				$(document).ready(function(){
					$(window).scrollTop(document.body.scrollHeight)
				})
			</script>
			<form method="post">
				<textarea id="comment" name="content">{{content}}</textarea>
				<button type="submit">Enviar comentario</button><FORM><INPUT Type="button" VALUE="Volver" onClick="history.go(-1);return true;"></FORM>
			</form>
		{%endif%}
		{%if editcomment==True%}
			<script type='text/javascript'>
				$("#hidden-edit-"+"{{comment.key().id()}}").css("display","block")
			</script>
		{%endif%}

		{%if reportcomment==True%}
			<script type='text/javascript'>
				$("#hidden-report-"+"{{comment.key().id()}}").css("display","block")
			</script>
		{%endif%}
		<script type="text/javascript">
		$(function () {
			$(".like").click(function () {
				var input = $(this).find('.qty1');
				var id_obj = $(this).parent().attr('id');
				$.ajax({
					url: '/likes_dislikes',
					type: 'GET',
					dataType: 'json',
					data: {'option': 'like','id_obj': id_obj},
				})
				.done(function(data) {
					if (data) {
						input.val(input.val() + 1);
						$(this).next('input: first-child').val()-1;
					}
					else {input.val(input.val() + 1);}
					console.log("success");
				})
				.fail(function() {
					console.log("error");
				});

			});
     		$(".dislike").click(function () {
         		var input = $(this).find('.qty2');
         		var id_obj = $(this).parent().attr('id')
         		$.ajax({
					url: '/likes_dislikes',
					type: 'GET',
					dataType: 'json',
					data: {'option': 'dislike','id_obj': id_obj},
				})
				.done(function(data) {
					if (data) {
						input.val(input.val() + 1);
						$(this).sibling().children().val()-1;
					}
					else {input.val(input.val() + 1);}
					console.log("success");
				})
				.fail(function() {
					console.log("error");
				});
     		});
  		});
		</script>

<br>
{%endif%}
</center>
{%endblock%}